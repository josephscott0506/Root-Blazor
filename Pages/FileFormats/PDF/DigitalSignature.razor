@page "/pdf/digital-signature"
@inject Microsoft.JSInterop.IJSRuntime JS
@using System.IO
@using Microsoft.AspNetCore.Http;
@using Syncfusion.Blazor.Buttons
@inject Microsoft.AspNetCore.Hosting.IHostingEnvironment hostingEnvironment
@*Hidden:Lines*@

@using blazor_samples.Data.FileFormats.PDF
@{
    SampleBrowser.CurrentSampleName = "Digital Signature";
    SampleBrowser.CurrentControlName = "PDF";
    SampleBrowser.CurrentControlCategory = "Security";
    SampleBrowser.CurrentControl = SampleBrowser.Config.PDF;  
}

@*End:Hidden*@
<div class="control-section">
    <div style="font-size:14px">
        <table>
            <tr>
                <td>
                    Click the button to view a PDF document generated by Essential PDF. Please note
                    that Adobe Reader or its equivalent is required to view the resultant document.
                </td>
            </tr>
        </table>
    </div>
    <div id="errorlabel" value="error">
    </div>
    <div class="tablediv" style="font-size:14px">
        <div class="rowdiv">
            <div class="celldiv">
                <table width="100%">
                    <tbody>
                        <tr>
                            <td align="left">
                                <span id="label8">Signature Settings</span>
                                <div style="border: solid 1px #788DB3; line-height: 23px; padding: 10px; ">
                                    <table cellspacing="0" cellpadding="0" border="0">
                                        <tbody>
                                            <tr>
                                                <td valign="middle" style="padding-left: 0px; width: 100%;">
                                                    <span id="label4">Cryptographic Standard: </span>
                                                    <span style="margin-left: 10px">
                                                        <input type="radio" value="CMS" name="Cryptographic" id="RadioButtonList1" Checked="@(Cryptographic == "CMS")" @onchange="@(() => Cryptographic = "CMS")" /><text for="Cryptographic">CMS</text>
                                                    </span>
                                                    <span style="margin-left: 20px">
                                                        <input type="radio" value="CAdES"
                                                               name="Cryptographic" id="RadioButtonList2_1" checked="@(Cryptographic == "CAdES" )" @onchange="@(()=> Cryptographic="CAdES")" /><text for="Cryptographic">CAdES</text>
                                                    </span>
                                                </td>

                                            </tr>
                                            <tr>
                                                <td valign="middle" style="padding-left: 0px; width: 100%;">
                                                    <br />
                                                    <span id="label4">Digest Algorithm: </span>
                                                    <span style="margin-left: 10px">
                                                        <input type="radio" value="SHA1" name="Digest_Algorithm" id="RadioButtonList1" checked="@(Digest_Algorithm=="SHA1")" @onchange="@(()=>Digest_Algorithm="SHA1")" /><text for="Cryptographic">SHA1</text>
                                                    </span>
                                                    <span style="margin-left: 20px">
                                                        <input type="radio" value="SHA256"
                                                               name="Digest_Algorithm" id="RadioButtonList3_1" checked="@(Digest_Algorithm=="SHA256")" @onchange="@(()=>Digest_Algorithm="SHA256")" /><text for="Digest_Algorithm">SHA256</text>
                                                    </span>
                                                    <span style="margin-left: 20px">
                                                        <input type="radio" value="SHA384"
                                                               name="Digest_Algorithm" id="RadioButtonList3_2" checked="@(Digest_Algorithm=="SHA384")" @onchange="@(()=>Digest_Algorithm="SHA384")" /><text for="Digest_Algorithm">SHA384</text>
                                                    </span>
                                                    <span style="margin-left: 20px">
                                                        <input type="radio" value="SHA512"
                                                               name="Digest_Algorithm" id="RadioButtonList3_3" checked="@(Digest_Algorithm=="SHA512")" @onchange="@(()=>Digest_Algorithm="SHA512")" /><text for="Digest_Algorithm">SHA512</text>
                                                    </span>
                                                    <span style="margin-left: 20px">
                                                        <input type="radio" value="RIPEMD160"
                                                               name="Digest_Algorithm" id="RadioButtonList3_4" checked="@(Digest_Algorithm=="RIPEMD160")" @onchange="@(()=>Digest_Algorithm="RIPEMD160")" /><text for="Digest_Algorithm">RIPEMD160</text>
                                                    </span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <br />
        <div class="rowdiv">
            <div class="celldiv">
                <table width="100%">
                    <tbody>
                        <tr>
                            <td align="left">
                                <span id="label8">Sign new PDF document</span><br>
                                <div style="border: solid 1px #788DB3; line-height: 23px; padding: 10px; ">
                                    <table cellspacing="0" cellpadding="0" border="0">
                                        <tbody>
                                            <tr>
                                                <td valign="middle" style="padding-left: 0px; width: 100%;">
                                                    <span id="label4">Standard Type: </span>
                                                    <span style="margin-left: 10px">
                                                        <input type="radio" value="Standard" name="RadioButtonList2" id="RadioButtonList1" checked="@(RadioButtonList2=="Standard")" @onchange="@(()=>RadioButtonList2="Standard")" /><text for="RadioButtonList2_0">Standard</text>
                                                    </span>
                                                    <span style="margin-left: 20px">
                                                        <input type="radio" value="Author"
                                                               name="RadioButtonList2" id="RadioButtonList2_1"><text for="RadioButtonList2_0" checked="@(RadioButtonList2=="Author")" @onchange="@(()=>RadioButtonList2="Author")" /><text>Author</text>
                                                    </span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td align="left">
                                                    <br />
                                                    <input name="submit" class="e-btn" id="submit" type="submit" @onclick="DigitalSignaturePDF" value="Create PDF" style="width: 150px;" />
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>

            </div>
        </div>
    </div>
</div>


<style>
    .radio-control {
        margin: 0 0 5% 0;
    }

    .control-section .row {
        margin: 10px 0;
    }
</style>

@code {
   
   
    string  RadioButtonList2 = "Standard", NewPDF = null, submit = null, Cryptographic = "CMS", Digest_Algorithm = "SHA256";
    /// <summary>
    /// Create and download the simple PDF document
    ///<summary>
    protected async void DigitalSignaturePDF(MouseEventArgs args)
    {        
        DigitalSignatureService service = new DigitalSignatureService(hostingEnvironment);
        MemoryStream documentStream = service.DigitalSignaturePDF(RadioButtonList2, NewPDF, Cryptographic, Digest_Algorithm);
        await JS.SaveAs("SignedPDF.pdf", documentStream.ToArray());
    }
}

